<div id="countdown">Loading...</div>

<script>
  const countdownEl = document.getElementById('countdown');

  let targetTime;

  async function fetchTargetTime() {
    try {
      const res = await fetch('/api/countdown'); // relative path to your API on Vercel
      const data = await res.json();
      targetTime = data.targetTime;
    } catch (err) {
      countdownEl.textContent = "Failed to load countdown";
    }
  }

  function updateCountdown() {
    if (!targetTime) return;

    const now = Date.now();
    let diff = targetTime - now;

    if (diff <= 0) {
      countdownEl.textContent = "Countdown Complete!";
      clearInterval(timer);
      return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    diff -= days * 1000 * 60 * 60 * 24;

    const hours = Math.floor(diff / (1000 * 60 * 60));
    diff -= hours * 1000 * 60 * 60;

    const minutes = Math.floor(diff / (1000 * 60));
    diff -= minutes * 1000 * 60;

    const seconds = Math.floor(diff / 1000);

    countdownEl.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
  }

  async function start() {
    await fetchTargetTime();
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Refresh countdown target from API every 30 seconds
    setInterval(fetchTargetTime, 30000);
  }

  start();
</script>
